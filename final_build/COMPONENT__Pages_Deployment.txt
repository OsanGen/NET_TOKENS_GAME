Pages Deployment

Purpose:
- Provide a deterministic, auditable GitHub Pages release path for the static game bundle.
- Publish `index.html`, `game.js`, `styles.css`, `favicon.ico`, and `assets/` to an explicit public URL (`https://<user>.github.io/<repo>/`).
- Support migration of hosting target and rollback of prior accidental publish changes on legacy repository paths.

Inputs:
- Source inputs:
  - Pushes to `main`.
  - Manual `workflow_dispatch`.
  - Required files: `index.html`, `game.js`, `styles.css`, `favicon.ico`, `assets/`.
- Runtime inputs:
  - Target repo (current `NET_TOKENS_GAME`)
  - Optional branch policy
  - Deployment approval/dispatch intent
- Local/CI verification inputs:
  - `GAME_PORT`/`GAME_HOST` for parity smoke (`5170`/`127.0.0.1`)

Outputs:
- GitHub Pages deployment artifact published from workflow run.
- Stable game route: `https://osangen.github.io/NET_TOKENS_GAME/`.
- Publish record (run id, commit SHA, asset presence, verification result).

Dependencies:
- Workflow runtime actions:
  - `actions/checkout@v4`
  - `actions/upload-pages-artifact@v3`
  - `actions/deploy-pages@v4`
- Repository settings:
  - Pages source set to `GitHub Actions`
  - DNS/branch target correctly pointing to `NET_TOKENS_GAME`
- Supporting scripts:
  - `/Users/abelsanchez/CODEX/NEWGAME/scripts/open-game.sh`
  - `/Users/abelsanchez/CODEX/NEWGAME/final_build/LINEAGE_AND_CHANGE_LOG.txt`

Deployment contract:
- Stage 1 (validate):
  - Ensure required files exist at repo root.
  - Optional lint-free static asset check on deploy bundle.
- Stage 2 (compose):
  - Copy `index.html`, `game.js`, `styles.css`, `favicon.ico`, `assets/` to `publish/`.
  - Include `.nojekyll` for stable asset serving.
- Stage 3 (upload):
  - `actions/upload-pages-artifact` creates deployment artifact.
- Stage 4 (deploy):
  - `actions/deploy-pages` writes public deployment for the configured repo.
- Stage 5 (verify):
  - HTTP probes validate index + critical assets.
- Stage 6 (evidence):
  - Log run metadata and verification results for rollback traceability.

State / External effects:
- External persistent state lives in GitHub Actions and Pages CDN.
- No runtime stateful changes inside the game bundle.
- CDN propagation may delay asset freshness after deployment.

Transition and rollback model:
- Normal forward publish:
  - commit -> push to `main` (or manual dispatch) -> workflow -> deploy success.
- Rollback model:
  - for accidental branding changes, use `git revert` chain on offending commits;
  - push corrected state to `main` and re-run workflow.
- Legacy route protection:
  - ensure old repo (`ai-power-users-codex53-demo`) is intentionally not pointed at active branding.

Edge Cases:
- Missing file set:
  - workflow fails preflight; no partial public publish should be assumed.
- Subpath hosting (`/NET_TOKENS_GAME/`):
  - root-relative URLs must remain valid under subpath or be replaced with path-safe alternatives.
- Legacy repo drift:
  - stale links to prior repo can still appear; requires explicit link map updates in docs.
- CDN cache stale:
  - stale index may remain briefly; verify using deployment run-specific evidence.
- Asset bundle size:
  - large changes increase publish/upload duration; monitor action timeout.
- Secret leakage:
 - runtime bundle must contain no credentials or tokens.
- Concurrent deploy runs:
  - run order follows GitHubâ€™s latest success ordering; keep serialized dispatch cadence.

Acceptance checks:
- `/.github/workflows/deploy-pages.yml` exists and includes `main` + `workflow_dispatch`.
- Deploy run returns successful artifact upload and `deploy-pages` completion.
- `curl -I https://osangen.github.io/NET_TOKENS_GAME/` returns `200`.
- `curl -I https://osangen.github.io/NET_TOKENS_GAME/styles.css` returns `200`.
- `curl -I https://osangen.github.io/NET_TOKENS_GAME/game.js` returns `200`.
- `curl -I https://osangen.github.io/NET_TOKENS_GAME/assets/sprites/ship.png` returns `200`.
- `curl -I https://osangen.github.io/NET_TOKENS_GAME/favicon.ico` returns `200`.
- `window.render_game_to_text` and `window.advanceTime` remain callable and unchanged as runtime contract.
- Legacy repo does not serve active `NET_TOKENS_GAME` branding artifacts.

Operational controls:
- Keep shared public URLs in one place (`ENTERPRISE_HANDFOFF_PACKAGE.txt` and rollout notes).
- Maintain post-deploy smoke checklist under `/output/web-game` capture or Playwright script.
- Ensure no local and remote path divergence between `index.html` and script src/href references.

Hardening plan:
- Add automated post-deploy verification workflow (optional):
  - fetch index and assets,
  - assert brand markers,
  - verify console script load success.
- Add deploy artifact size budgets and failure alarms for oversized or missing bundles.
- Keep branch strategy explicit: only `main` for production publish.
