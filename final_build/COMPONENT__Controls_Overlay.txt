Component: Controls Overlay
Purpose:
Keep gameplay controls, mode status, and mission telemetry on a glass-style external HUD rail while preserving a premium, highly legible frame around the canvas.
The overlay must stay readable at a glance, remain synchronized every frame, and never mutate gameplay state.

Visual contract:
- Shell chrome and HUD panels must feel modern and intentional across desktop/mobile.
- Start/goal/metric text must remain high-contrast against animated glow layers.
- Help toggle, action list, and mission telemetry must remain scannable with reduced-motion set.
- Visual state should be mode/preset-reactive and deterministic (no random chrome flicker).
- Visual color system must be token-driven (`styles.css` custom properties) so mode changes only swap token values, not selector structure.
- Additional animation layers should remain subtle, deterministic, and readable even on battery-constrained/mobile targets.
- Current visual direction is intentionally radical and obvious to non-technical viewers:
  - clipped command-frame geometry, brighter cyan/mint/amber palette, and stronger hero hierarchy.
  - shell and HUD chrome should read as enterprise dashboard + premium game, not retro flat panel.

Inputs:
- Mode (`title`, `hub`, `mission`, `battle`, `result`).
- HUD state from:
  - `state.ui.helpVisible`
  - `state.ui.helpPinned`
- `state.ui.autoHelpUntilFrame`
- `state.ui.firstMissionHelpShown`
- Mode context from:
  - `contextActionsForMode()`
  - `objectiveHintText()`
- Action context from:
  - `externalActionsForMode()`
  - `resolveBattleActionsForMode()`
- Metrics contract from:
  - `syncModeMetricsPayload()`.
- `styles.css` visual classes:
  - `.page-shell`, `.game-shell`, `.shell-ornament-*`
  - `.controls-panel`, `.hud-panel`
  - `.controls-actions`, `.hud-console-list`
  - `#start-btn`
- Structural shell classes:
  - `.command-shell`
  - `.command-stage`
- New animated chrome keys:
  - `actionStream`, `actionPulse`, `badgeSweep`, `panelShimmer`, `statusSlide`, `cmdGlow`
- JS chrome-state hooks:
  - `body[data-game-mode]`
  - `body[data-visual-preset]`
  - `body[data-motion-state]`
- `body[data-visual-tier]`
- `body[data-ui-tier]`
- Decorative shell markup from `index.html`:
  - `.shell-ornament.shell-ornament-left`
  - `.shell-ornament.shell-ornament-right`
  - `.command-shell`
  - `.command-stage`

Outputs:
- External controls panel in DOM:
  - `#controls-panel`
- `#controls-actions`
- `#controls-objective`
- Structured HUD panels in DOM:
  - `#hud-intro`
  - `#hud-objective`
  - `#hud-threat`
  - `#hud-missions`
- `#hud-console`
- Render contract in `render_game_to_text().ui.metrics`:
  - `phase`
  - `threatScore`
  - `objectiveProgress`
  - `enemyCount`
  - `comboHint`
  - `cooldownState`
  - `frameBudget`
- Visual chrome render:
  - Canvas frame shell and start CTA in DOM with modern chrome (`#game-shell`, `#start-btn`).
  - Left/right shell ornaments visible and static at the panel corners.

State:
- `state.ui.helpVisible`: current manual visibility state.
- `state.ui.helpPinned`: manual override for auto-help behavior.
- `state.ui.autoHelpUntilFrame`: initial visibility window.
- `state.ui.firstMissionHelpShown`: mission onboarding gate.
- DOM refs:
  - `#controls-toggle`
  - `#controls-actions`
  - `#controls-objective`
  - `hudNodes` map for all `#hud-*` metrics.

Behavior:
- `syncExternalControlsUI()` is the single source of truth for overlay state.
- `H` key and `#controls-toggle` route through the same visibility path and sync panel class `.is-collapsed`.
- `externalActionsForMode()` filters out redundant `H: help` action from in-panel action list.
- `resolveBattleActionsForMode()` reads move options from active player pet and marks selected entry.
- `syncModeMetricsPayload()` produces a stable UI snapshot and scene-aware label strings.
- `syncHudTextNode()` + `updateHudNodeClass()` apply class states (`.is-critical`, `.is-warning`, `.is-ready`, `.is-muted`, `.is-digital`) to threat and action chips.
- `hudNodes.consoleLines` keeps the last 2–3 console messages and stays fixed-height.
- `styles.css` now applies a layered glass and neon panel system:
  - dynamic shell backplate gradient pass,
  - panel borders and pseudo-element glow,
  - ornament rings around gameplay canvas,
  - interactive action-row hover/selection polish,
  - animated focus treatment for `#start-btn`.
- Latest style pass replaces the previous look with a visibly distinct dashboard language:
  - `Sora` + `Manrope` typography stack.
  - clipped-corner game shell with high-contrast frame edges.
  - stronger CTA treatment and brighter, mode-sensitive shell borders.
  - restrained ambient grid + sweep animations with reduced-motion compatibility.
- `styles.css` now uses a deeper tokenized chroma layer:
  - game shell gradients, shell ornaments, ambient background wash, CTA tones, panel scan speeds, and strip/chip glow all flow from `:root` tokens and preset overrides.
- Dynamic animation controls are tokenized per preset/mode:
  - `--shell-scan-speed`, `--game-shell-scan-speed`, `--shell-halo-speed`, `--shell-orbit-speed`
  - `--panel-pulse-speed`, `--status-slide-speed`, `--action-stream-speed`, `--cta-sheen-speed`, `--cta-beat-speed`
- `syncExternalControlsUI()` now publishes mode/preset/motion state to `<body>` attributes used by CSS:
  - `data-game-mode` for mode-aware panel and CTA chrome.
  - `data-visual-preset` for shell and control palette adaptation.
  - `data-motion-state` for reduced-motion fallback behavior.
- `syncExternalControlsUI()` now publishes tiered visual state:
  - `data-visual-tier` for full mode/preset/profile-mode signal.
  - `data-ui-tier` for manual-vs-auto profile intent.

Behavior in-game:
- Drawn HUD inside canvas is minimal (compact emergency strip only) while full mission/action/completion context is external.
- In-mission and battle objective detail remains visible in `#hud-objective`, `#hud-missions`, and `#hud-console`.
- `drawMissionStatusStrip()` remains inactive so objective/status copy is not duplicated on the canvas.

Edge Cases:
- If expected DOM nodes are missing, synchronization fails open with no gameplay mutation.
- Mobile layouts collapse and stack as the right rail below the canvas.
- Reduced-motion preference applies to animation-heavy UI classes via CSS class hook.
- If browser animation is disabled, the overlay must still remain readable with all pseudo-element glow and pulse effects effectively static.
- On narrow viewports, the `.controls-actions` two-column layout should not wrap mission actions beyond visible bounds.
- Preset transitions should keep animation duration behavior consistent (e.g., minimal style does not animate chrome layers aggressively).
- New:
  - 390px and 768px layouts should preserve contrast for status chips and keep start CTA tappable.
  - shell ornaments remain visible and symmetric in compact layouts.
  - `body[data-motion-state="reduced"]` and desktop `prefers-reduced-motion` should suppress high-frequency effects while preserving baseline structure.

Dependencies:
- `/Users/abelsanchez/CODEX/NEWGAME/game.js`
- `/Users/abelsanchez/CODEX/NEWGAME/index.html`
- `/Users/abelsanchez/CODEX/NEWGAME/styles.css`

Acceptance Checks:
- `H` and `#controls-toggle` immediately update visibility and panel collapse state.
- Mode transitions (title→hub→mission→result) update action/objective/console text deterministically without gameplay changes.
- `.command-shell` and `.command-stage` wrappers exist without affecting HUD synchronization.
- At least 70% of control/status context is in DOM HUD (not canvas overlays).
- Threat/mission chips render state classes for instant readability.
- Keyboard and objective HUD remain visible during gameplay while keeping gameplay canvas visually uncluttered.
- Battle action list uses active player pet move options and visibly indicates selected move.
- `.page-shell`, `.controls-panel`, and `.hud-panel` styles include modern glass borders and layered gradient accents.
- `.shell-ornament-left` and `.shell-ornament-right` are both visible during normal and reduced-motion modes.
- `.controls-actions` hover/selected visuals still satisfy contrast constraints.
- Desktop shell chrome and mobile (390px/768px) remain legible and stable with reduced-motion preference active.
- Mode/preset transitions do not introduce layout jumps; only cosmetic motion/color tokens update.
- Visual comparison against pre-pass build is immediately noticeable without interaction.
